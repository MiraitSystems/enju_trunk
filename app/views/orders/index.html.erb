<div id="content_detail" class="ui-corner-all">
<h1 class="title"><%= t('page.listing', :model => t('activerecord.models.order')) -%></h1>
<div id="content_list">

<% if @manifestation %>

  <p>
    <%= t('activerecord.attributes.manifestation.original_title') -%>:
    <%= @manifestation.original_title %>
  </p>

  <p>
    <%= t('activerecord.attributes.order.order_identifier') %>
    <%= text_field :order, :order_identifier, {:disabled => true} %>

    <%= t('activerecord.attributes.order.order_year') %>:
    <%= select('', :order_year, @select_years, {:selected => @selected_year, :prompt => t('page.all_search_term')}, :disabled => "") %><br />
  </p>

<% else %>
  <%= form_tag({:action => "search"},  {:method => "get"}) do %>
    <% if @selected_title %>
      <p>
      <%= t('activerecord.attributes.manifestation.original_title') -%>:
      <%= @selected_title %>
      </p>
    <% end %>

    <p>
    <%= t('activerecord.attributes.order.order_identifier') -%>:
    <%= text_field_tag :order_identifier, @selected_order %>

    <%= t('activerecord.attributes.order.order_year') %>:
    <%= select('', :order_year, @select_years, {:selected => @selected_year, :prompt => t('page.all_search_term')}) %>
    </p>

    <%= submit_tag t('page.search') %>

  <% end %>
<% end %>

<div style="color: red"><%= raw flash[:message].to_s -%></div>
<p id="notice"><%= notice %></p>

<table class="index">
  <tr>
    <th><%= t('activerecord.attributes.order.order_year') -%></th>
    <th><%= t('activerecord.attributes.order.order_identifier') -%>/</br>
    <%= t('activerecord.attributes.manifestation.identifier') -%></th>
    <th><%= t('activerecord.attributes.order.cost') -%></th>
    <th><%= t('activerecord.attributes.order.payment_sum') -%></th>
    <th><%= t('activerecord.attributes.order.adption_code') %>/</br>
    <%= t('activerecord.attributes.order.bookstore_code') %></th>
    <th><%= t('activerecord.attributes.order.payment_form_code') %>/</br>
    <%= t('activerecord.attributes.order.collection_status_code') %></th>
    <th><%= t('activerecord.attributes.order.deliver_place_code_1') %>/</br>
    <%= t('activerecord.attributes.order.reference_code_id') %></th>
    <th></th>
  </tr>

<%- @orders.each do |order| -%>
  <tr class="line<%= cycle("0", "1") -%>">
    <td><%= order.order_year %></td>
    <% if @manifestation %>
      <td><%= link_to order.order_identifier, order_path(order, :return_index => true) %></br>
    <% else %>
      <td><%= link_to order.order_identifier, order_path(order) %></br>
    <% end %>
    <%= link_to order.manifestation.identifier, order.manifestation, {:href =>manifestation_path(order.manifestation, :all_manifestations => true)} %></td>

    <td><%= order.cost %></td>
    <td><%= order.total_payment %></td> 
    <td><%= order.adption.keyname if order.adption -%></br>
    <%= order.bookstore.keyname if order.bookstore -%></td>
    <td><%= order.payment_form.keyname if order.payment_form -%></br>
    <%= order.collection_status.keyname if order.collection_status -%></td>
    <td><%= order.deliver_place_1.keyname if order.deliver_place_1 -%></br>
    <%= order.reference_code.keyname if order.reference_code -%></td>

    <td>
        <% if @manifestation %>
          <%= link_to t('page.edit'), edit_order_path(order, :return_index => true) -%><br />
          <% if order.destroy? %>
            <%= link_to t('page.destroy'), order_path(order, :return_index => true), :confirm => t('page.are_you_sure'), :method => :delete -%>
          <% end %>
        <% else %>
          <%= link_to t('page.edit'), edit_order_path(order) -%><br />
          <% if order.destroy? %>
            <%= link_to t('page.destroy'), order_path(order), :confirm => t('page.are_you_sure'), :method => :delete -%>
          <% end %>
        <% end %>
    </td>
  </tr>
<%- end -%>
</table>

<%= paginate(@orders) -%>

</div>
</div>

<% if @manifestation %>
  <div id="submenu" class="ui-corner-all">
    <ul>
      <li><%= link_to t('page.new', :model => t('activerecord.models.order')), new_order_path(:manifestation_id => @manifestation, :return_index => true) %></li>
    </ul>
  </div>
<% else %>
  <% if(@selected_year.present? && @orders.size != 0) %>
    <div id="submenu" class="ui-corner-all">
      <ul>
        <li><%= link_to t('order.create_subsequent_year_orders'), {:controller => 'orders', :action =>'create_subsequent_year_orders', :year => @selected_year, :order_identifier => @selected_order}, :confirm => t('order.create_year_orders_confirm', :year => (Date.today.year.to_i+1)) %></li>
      </ul>
    </div>
  <% end %>
<% end %>

