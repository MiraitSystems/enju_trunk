<div id="content_detail" class="ui-corner-all">
<h1 class="title"><%= t('page.listing', :model => t('activerecord.models.order')) -%></h1>
<div id="content_list">

<% if @manifestation %>
  <p>
    <%= t('activerecord.attributes.manifestation.original_title') -%>:
    <%= text_field :manifestation, :original_title, {:value =>  @manifestation.original_title, :class => 'resource_title', :disabled => true} %>
  </p>

  <p>
    <%= t('activerecord.attributes.manifestation.identifier') -%>:
    <%= text_field :manifestation, :identifier, {:value => @manifestation.identifier, :disabled => true} %>

    <%= t('activerecord.attributes.order.publication_year') %>:
    <%= select('', :publication_year, @select_years, {:selected => @selected_year, :prompt => t('page.all_search_term')}, :disabled => "") %><br />
  </p>

<% else %>
  <%= form_tag({:action => "search"},  {:method => "get"}) do %>
    <p>
    <%= t('activerecord.attributes.manifestation.original_title') -%>:
    <%= text_field_tag :manifestation_original_title , @selected_title, :class => 'resource_title'%>
    </p>

    <p>
    <%= t('activerecord.attributes.manifestation.identifier') -%>:
    <%= text_field_tag :manifestation_identifier, @selected_manifestation %>

    <%= t('activerecord.attributes.order.publication_year') %>:
    <%= select('', :publication_year, @select_years, {:selected => @selected_year, :prompt => t('page.all_search_term')}) %>
    </p>

    <%= submit_tag t('page.search') %>

  <% end %>
<% end %>

<div style="color: red"><%= flash[:message].to_s -%></div>
<p id="notice"><%= notice %></p>

<table class="index">
  <tr>
    <th><%= t('activerecord.attributes.order.publication_year') -%></th>
    <th><%= t('activerecord.attributes.order.order_identifier') -%>/</br>
    <%= t('activerecord.attributes.manifestation.identifier') -%></th>
    <th><%= t('activerecord.attributes.order.yen_imprest') -%></th>
    <th><%= t('activerecord.attributes.order.payment_sum') -%></th>
    <th><%= t('activerecord.attributes.order.adption_code') %>/</br>
    <%= t('activerecord.attributes.order.bookstore_code') %></th>
    <th><%= t('activerecord.attributes.order.payment_form_code') %>/</br>
    <%= t('activerecord.attributes.order.collection_status_code') %></th>
    <th><%= t('activerecord.attributes.order.deliver_place_code_1') %>/</br>
    <%= t('activerecord.attributes.order.deliver_place_code_5') %></th>
    <th></th>
  </tr>

<%- @orders.each do |order| -%>
  <tr class="line<%= cycle("0", "1") -%>">
    <td><%= order.publication_year %></td>
    <td><%= link_to order.order_identifier, order_path(order) %></br>
    <%= link_to order.manifestation.identifier, order.manifestation, {:href =>manifestation_path(order.manifestation, :all_manifestations => true)} %></td>

    <td><%= order.yen_imprest %></td>
    <td></td> 
    <td><%= order.adption.keyname if order.adption -%></br>
    <%= order.bookstore.keyname if order.bookstore -%></td>
    <td><%= order.payment_form.keyname if order.payment_form -%></br>
    <%= order.collection_status.keyname if order.collection_status -%></td>
    <td><%= order.deliver_place_1.keyname if order.deliver_place_1 -%></br>
    <%= order.deliver_place_5.keyname if order.deliver_place_5 -%></td>

    <td>
        <%= link_to t('page.edit'), edit_order_path(order) -%><br />
        <% if order.destroy? %>
          <%= link_to t('page.destroy'), order_path(order), :confirm => t('page.are_you_sure'), :method => :delete -%>
        <% end %>
    </td>
  </tr>
<%- end -%>
</table>

<%= paginate(@orders) -%>

</div>
</div>

<% if @manifestation %>
  <div id="submenu" class="ui-corner-all">
    <ul>
      <li><%= link_to t('page.new', :model => t('activerecord.models.order')), new_order_path(:manifestation_id => @manifestation) %></li>
    </ul>
  </div>
<% else %>
  <% if (@search_manifestation && @orders.size == 0) || (@selected_year && @orders.size != 0) %>
    <div id="submenu" class="ui-corner-all">
      <ul>
        <% if (@search_manifestation && @orders.size == 0) %>
          <li><%= link_to t('page.new', :model => t('activerecord.models.order')), new_order_path(:manifestation_id => @search_manifestation) -%></li>
        <% end %>
        <% if (@orders.size != 0 && @selected_year) %>
          <li><%= link_to t('order.create_subsequent_year_orders'), {:controller => 'orders', :action =>'create_subsequent_year_orders', :year => @selected_year, :manifestation_identifier => @manifestation_selected}, :confirm => t('order.create_year_orders_confirm', :year => (Date.today.year.to_i+1)) %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% end %>
