<script>
$(function() {
    $('.opac_manifestations_row').click(function(e) {
      if(!$(e.target).is('a')){
        window.location = $(e.target).closest('tr').data('href');
      };
  });
});
</script>

<div id="opac_header">
  <div class="opac_title">
    <h1><%= t('page.search_resource', :model => t('page.resource')) %></h1>
  </div>
  <div class="opac_head_button_area">
    <%= link_to opac_search_path do %><div class="opac_head_button"><%= t('opac.catalog_search') %></div><% end %> 
    <%= link_to opac_path do %><div class="opac_head_button"><%= t('opac.finish') %></div><% end %>
  </div>
</div>

<div id="opac_content_detail"> 
  <% if @manifestations && (@manifestations.size > 0) %> 
    <p>
      <%= t('page.search_term') %>: <%= @query %><br />
      <%= t('page.number_of_search_results', 
        :count => @count[:query_result], 
        :numdocs => Manifestation.cached_numdocs, 
        :seconds => sprintf("%.3f", @seconds)) %>
      <% if @count[:query_result] > SystemConfiguration.get("max_number_of_results") %>
        <br />
        <%= t('page.limit_exceeded', :count => SystemConfiguration.get("max_number_of_results")) %>
      <% end %>
    </p>

    <%= render 'opac/manifestations/sort_menu' %>

    <table class="index" id="opac_manifestation_list" style="clear: both;">
      <% @manifestations.each do |manifestation| %>
        <tr class="opac_line<%= cycle("0", "1") %> opac_manifestations_row" data-href="<%= manifestation_path(manifestation, :opac => true) %>">
          <td>
            <div class="opac_list_title">
              <%= manifestation.original_title %>
            </div>
            <% unless manifestation.creators.readable_by(current_user).empty? and manifestation.publishers.readable_by(current_user).empty? %>
              <div class="opac_list_patrons">
                <% unless manifestation.creators.readable_by(current_user).empty? %>
                  <%= t('patron.creator')%>:<%= patrons_short_list(manifestation.creators.readable_by(current_user), { :nolink => 'true' }) %>&nbsp;&nbsp;  
                <% end %>
                <% unless manifestation.publishers.readable_by(current_user).empty? %>
                  <%= t('patron.publisher') %>: <%= patrons_short_list(manifestation.publishers.readable_by(current_user), { :nolink => 'true' }) %>
                <% end %>
              </div>
             <% end %>
          </td>
        </tr>
      <% end %>
    </table>
    <%= paginate @manifestations, :theme => 'opac_theme' %>
  <% else %>
    <%= render 'opac/manifestations/not_found' %>
  <% end %>
</div>
