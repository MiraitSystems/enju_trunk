<%= form_for(@family) do |f| %>
  <%= f.error_messages %>

  <%= t('family.create_family') -%>
  <div id="family_users">
  <%- if @already_family_users -%>
    <%- @already_family_users.each do |user| -%>
      <div id='add_<%= user.id -%>'>
        <input type='hidden' name='family_users[]' value="<%= user.id -%>"><%= user.username -%>
        <a href='javascript:removeUser("<%= user.id -%>")'><%= t('family.remove') -%></a>
      </div>
    <%- end -%>
  <%- end -%>
  </div>

  <div class="actions">
    <%= f.submit %>
  </div>
<%- end -%>

<div style="color: green"><%= flash[:message] -%></div>
<%= form_for @family, :html => {:onsubmit => "javascript:get_users(query);return false;"}, :remote => true do -%>
  <p>
    <%= t('page.search_term') -%>: <%= search_field_tag 'query', h(@query), {:id => 'search_form_top', :class => 'search_form', :placeholder => t('page.search_term')} -%><br />
    <%= t('activerecord.attributes.user.birth_date') -%>: <%= text_field_tag 'birth_date', @date_of_birth, :class => 'wide_date_text_field', :placeholder => "#{t('page.example')}: 2011-04-12" -%>
    <%= t('activerecord.attributes.user.adddress') -%>: <%= text_field_tag 'address', @address, :class => 'search_form' -%>
    <%= hidden_field_tag 'patron_id', @patron.id if @patron -%>
    <%= submit_tag t('page.search') -%>
  </p>
<%- end -%>

<script>
  function get_users(query){
    alert("<%= url_for(:controller => :families, :action => "search_user") -%>");
    $.ajax({
      type: "GET",
      url: url_for(:controller => :families, :action => :search_user),
      data: query,
      success: function(obj){
        alert("success");
      }
    });
    alert("emiko");
    return false;
  }

</script>
<%= render :partial => "user_list" %>
