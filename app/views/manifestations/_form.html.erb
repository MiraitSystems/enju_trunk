<script>
jQuery(function(){
  new AutoKana('manifestation_original_title', 'manifestation_title_transcription', { katakana:true, toggle:false });

  var article_title = "<%= @manifestation.article_title %>"
  displayArticleTitle(article_title);
  $('#manifestation_manifestation_type_id').change(function () {
    article_title = ""
    displayArticleTitle(article_title);
  });

  <% if SystemConfiguration.get('manifestation.check_duplicate_title') %>
    // look for manifestations with the same title
    <% unless @manifestation.new_record? %>
      search_manifestation();
    <% end %>
    $("#manifestation_original_title").change(function(){
       search_manifestation();
    });
  <% end %>
})

<% if SystemConfiguration.get('manifestation.check_duplicate_title') %>
  // look for manifestations with the same title
  function search_manifestation() {
    //var user_id = $("#manifestation_original_title").val();
    $.ajax({
      type: "GET",
      url: "/manifestations/search_manifestation",
      data: { 
        "original_title": $("#manifestation_original_title").val(),
        "manifestation_id": "<%= @manifestation.try(:id) %>"
      },
      success: function(obj) {
        $('#search_manifestation > li').remove();
        $('#search_manifestation').hide();
        if(obj["manifestation_urls"] && obj["manifestation_urls"].length > 0) {
          $('#search_manifestation').show();
          var data = "<strong><%= t('manifestation.same_manifestation_already_exist', :attribute => t('activerecord.attributes.manifestation.original_title')) %></strong>"
          data += "<ui>";
          jQuery.each(obj["manifestation_urls"], function(index, value) {  
            data += "<li>";
            data += value;
            data += "</li>";
          });
          data += "</ui>";
          $('#search_manifestation').html(data);
        } 
      }
   });
 } 
<% end %>

function displayArticleTitle(article_title) {
  var manifestation_type = $('#manifestation_manifestation_type_id').val();
  var series  = ['3', '4', '5', '6']; 
  var article = ['9', '10'];
  var pub_data_field = "<label class='pub_date' for='manifestation_pub_date'><%= t('activerecord.attributes.manifestation.pub_date')%></label>";

  if($.inArray(manifestation_type, article) != -1) {
    $("#article_title_field").show();
    pub_data_field = "<label class='pub_date' for='manifestation_pub_date'><%= t('activerecord.attributes.manifestation.pub_date_article')%></label>"
    $("#frequency_field").hide();
    $("#manifestation_frequency_id").val("17");
  } else if($.inArray(manifestation_type, series) != -1) {
    $("#frequency_field").show(); 
    $("#article_title_field").hide();
    $("#manifestation_article_title").val("");
  } else {
    $("#frequency_field").hide();
    $("#manifestation_frequency_id").val("17");
    $("#article_title_field").hide();
    $("#manifestation_article_title").val("");
  }
  $(".pub_date").html(pub_data_field);
}
$(document).keydown(function(e) {
  $("input[type=text]").keypress(function(ev) {
   if ((ev.which && ev.which === 13) ||
        (ev.keyCode && ev.keyCode === 13)) {
      return false;
    } else {
      return true;
    }
  });
});
</script>

<% if defined?(EnjuTrunkTheme) %>
  <script id="script_theme">
    $(document).ready(function() { 
      $("#manifestation_theme").select2({
        multiple: true, 
        data: <%= raw @select_theme_tags.to_json -%>, 
        formatNoMatches: function(term) {
          return <%= raw t("page.theme.no_matches_found").to_json %>;
        },
        width: "300px",
      }); 
    });
  </script>
<% end %>

<script>
  var ItemField_language = {
    currentNumber : <%= raw (@work_has_languages.blank? ? 1 : @work_has_languages.size).to_json %>,
    itemTemplate : ''
      + '<select id="language_id___count__" name="language_id[__count__]">'
      + <%= raw @languages.collect{ |l| ["<option value='" + l.id.to_s + "'>" + l.display_name.localize + "</option>"] }.join().to_json %>
      + '</select>&#10'
      + '<select id="language_type___count__" name="language_type[__count__]">'
      + <%= raw @language_types.collect{ |t| ["<option value='" + t.id.to_s + "'>" + t.display_name.localize + "</option>"] }.join().to_json %>
      + '</select>&#10'
      + '<input type="button" value="+" onClick="ItemField_language.add();" /> '
      + '<input type="button" value="-" onClick="ItemField_language.remove(__count__);" />',
    add : function () {
      var field = document.getElementById('language');
      var new_area = document.createElement("div");
      new_area.setAttribute("id", "LANG" + this.currentNumber);
      var newItem = this.itemTemplate.replace(/__count__/mg, this.currentNumber);
      new_area.innerHTML = newItem;
      field.appendChild(new_area);
      this.currentNumber += 1;
    },
    remove : function (div_num) {
      var field = document.getElementById('LANG' + div_num);
      if(field != null){ field.parentNode.removeChild(field); }
    }
  }
</script>

<select id="languages_select2_hidden" style="display: none;">
  <%= raw @languages.collect{ |l| ["<option alt='" + l.name + "', value='" + l.id.to_s + "'>" + l.display_name.localize + " (" + l.name + ")</option>"] } %>
</select>
<select id="language_types_select2_hidden" style="display: none;">
  <%= raw @language_types.collect{ |t| ["<option alt='" + t.name + "', value='" + t.id.to_s + "'>" + t.display_name.localize + " (" + t.name + ")</option>"] } %>
</select>
<script>
  var ItemField_language_select2 = {
    currentNumber : <%= raw (@work_has_languages.blank? ? 1 : @work_has_languages.size).to_json %>,
    itemTemplate : ''
      + '<input type="button" value="+" onClick="ItemField_language_select2.add();" /> '
      + '<input type="button" value="-" onClick="ItemField_language_select2.remove(__count__);" />',
    add : function () {
      // language_clone
      var $clone = $("#languages_select2_hidden").clone();
      $clone[0].id = 'select2_language';
      $clone.show();

      // language_type_clone
      var $type_clone = $("#language_types_select2_hidden").clone();
      $type_clone[0].id = 'select2_language_type';
      $type_clone.show();

      // form のid,name設定
      $clone.attr('name', 'language_id[' + this.currentNumber + ']'); 
      $type_clone.attr('name', 'language_type[' + this.currentNumber + ']'); 
      var $new_field = $("<div/>").attr("id", "LANG" + this.currentNumber);
      var newItem = this.itemTemplate.replace(/__count__/mg, this.currentNumber);

      var new_area = document.createElement("div");
      new_area.setAttribute("id", "LANG" + this.currentNumber);
      $new_field.append($clone);
      $new_field.append($type_clone);
      $new_field.append(newItem);

      $("#language").append($new_field);

      this.currentNumber += 1;
      $clone.select2({
        width: "300px",
        matcher: function(term, text, opt) {
          return text.toUpperCase().indexOf(term.toUpperCase())==0
              || opt.attr("alt").toUpperCase().indexOf(term.toUpperCase())==0;
        }
      });
      $type_clone.select2({
        width: "200px",
        matcher: function(term, text, opt) {
          return text.toUpperCase().indexOf(term.toUpperCase())==0
              || opt.attr("alt").toUpperCase().indexOf(term.toUpperCase())==0;
        }
      });
    },
    remove : function (div_num) {
      var field = document.getElementById('LANG' + div_num);
      if(field != null){ field.parentNode.removeChild(field); }
    }
  }
</script>
<%# TODO %>

<script id="script_add_title">
  var ItemField_title = {
    currentNumber: <%= raw (@work_manifestation.work_has_titles.size == 0 ? 1 : @work_manifestation.work_has_titles.size).to_json %>,
    template : ''
      + '<div class="field">'
      + '<input id="work_has_titles_attributes___count___title_str" name="work_has_titles_attributes___count___title_str" placeholder=<%= t('activerecord.models.title') %> type="text" class="resource_title" /> '
      + '<select id="manifestation_work_has_titles_attributes___count___title_type_id" name="manifestation[work_has_titles_attributes][__count__][title_type_id]"> '
      <% @title_types.collect do |m| %>
        + '<option value="<%= m.id %>"><%= m.display_name %></option>'
      <% end %>
      + '<input id="manifestation_work_has_titles_attributes___count___title_id" name="manifestation[work_has_titles_attributes][__count__][title_id]" type="hidden" value="" /> '
      + '<input id="manifestation_work_has_titles_attributes___count___title_id" name="manifestation[work_has_titles_attributes][__count__][position]" type="hidden" value="__count__" />'
      + '<input type="button" value="+" onClick="ItemField_title.add();" />  '
      + '<input type="button" value="-" onClick="ItemField_title.remove(__count__);" /> '
      + '</div>',
    add : function () { add_field(this, 'titles', 'VF'); },
    remove : function (div_num) { remove_field(div_num, 'VF'); }
  };
</script>

<script>
  var ItemField_identifier = {
    itemTemplate : ''
      + '<input id="manifestation_identifiers_attributes___count___body" name="manifestation[identifiers_attributes][__count__][body]" size="30" type="text" />&#10'
      + '<select id="manifestation_identifiers_attributes___count___identifier_type_id" name="manifestation[identifiers_attributes][__count__][identifier_type_id]"> '
      + <%= raw @identifier_types.collect{ |identifier_type| ["<option value='" + identifier_type.id.to_s + "'>" + identifier_type.display_name.localize + "</option>"] }.join().to_json %>
      + '</select>&#10'
      + '<input id="manifestation_identifiers_attributes___count___position" name="manifestation[identifiers_attributes][__count__][position]" type="hidden" value=__position__ />'
      + '<input type="button" value="+" onClick="ItemField_identifier.add();" /> '
      + '<input type="button" value="-" onClick="ItemField_identifier.remove(__count__);" />',
    add : function () {
      var current = $("[id^='identifiers']").length;
      var field = document.getElementById('identifiers');
      var new_area = document.createElement("div");
      new_area.setAttribute("class", "field");
      new_area.setAttribute("id", "identifiers_" + current);
      var newItem = this.itemTemplate.replace(/__count__/mg, current).replace(/__position__/mg, current);
      new_area.innerHTML = newItem;
      field.appendChild(new_area);
    },
    remove : function (currentNumber) {
      if ( currentNumber == 0) { return; }
      var field = document.getElementById('identifiers_' + currentNumber);
      var new_area = document.createElement("input");
      new_area.setAttribute("type", "hidden");
      new_area.setAttribute("name", "manifestation[identifiers_attributes][" + currentNumber + "][_destroy]");
      new_area.setAttribute("value", true);
      field.appendChild(new_area);
      field.style.display = 'none';
    }
  }
</script>

<%= render 'page/required_field' %>
<%= render 'observe_field' %>
<%= simple_form_for(@manifestation, :html => { :multipart => true }) do |f| -%>
  <%= f.error_messages -%>

  <div class="field">
    <%- if !@manifestation.new_record? and @manifestation.series_statement -%>
      <%= f.hidden_field :series_statement_id, :value => @manifestation.series_statement.id -%>
      <%= f.label t('activerecord.models.series_statement') -%>
      <%= link_to @manifestation.series_statement.original_title, @manifestation.series_statement -%>
      (<%= link_to t('series_statement.edit'), series_statements_path(:manifestation_id => @manifestation.id) -%>)
    <%- else -%>
      <%= f.hidden_field :series_statement_id, :value => @manifestation.series_statement.id if @manifestation.series_statement-%>
      <%= f.label t('activerecord.models.series_statement') -%>
      <%= link_to @manifestation.series_statement.original_title, @manifestation.series_statement if @manifestation.series_statement -%>
      <% if @manifestation.new_record? %>
        (<%= link_to t('page.listing', :model => t('activerecord.models.series_statement')), series_statements_path -%>)
      <% else %>
        (<%= link_to t('page.listing', :model => t('activerecord.models.series_statement')), manifestation_series_statements_path(@manifestation) -%>)
      <%- end -%>
    <%- end -%>
  </div>

  <table style='border:none; margin: -4px;'>
    <tr>
      <td style='border:none;'>
        <div class="field">
          <%= f.label :original_title -%><br />
          <%= f.text_field :original_title, :class => 'resource_title' -%>
        </div>
      </td>
      <td style='border:none;'>
        <div id="search_manifestation"></div>
      </td>
    </tr>
    <tr>
      <td style='border:none;'>
        <div class="field">
          <%= f.label :title_transcription -%><br />
          <%= f.text_field :title_transcription, :class => 'resource_title' -%>
        </div>
        <div class="field">
          <%= f.label :title_alternative -%><br />
         <%= f.text_field :title_alternative, :class => 'resource_title' -%>
        </div>
        <div class="field" id="article_title_field">
          <%= f.label :article_title %><br />
          <%= f.text_field :article_title, :class => 'resource_title' %>
        </div>
      </td>
    </tr>
  </table>

  <% if SystemConfiguration.get('manifestation.use_titles') %>
    <div class="field" id='titles'>
      <% @work_manifestation.work_has_titles << WorkHasTitle.new(:position => 0) if @work_manifestation.work_has_titles.blank? %>
      <% @work_manifestation.work_has_titles.each_with_index do |work_has_title, index| %>
        <%= f.fields_for :work_has_titles, work_has_title do |w_f| %>
          <div class="field" id="VF<%= index %>">
            <% if work_has_title.manifestation_title %>
              <%= text_field_tag "work_has_titles_attributes_#{index}_title_str",
                work_has_title.manifestation_title.title,
                :placeholder => t('activerecord.models.title'),
                :class => 'resource_title' %>
            <% else %>
              <%= text_field_tag "work_has_titles_attributes_#{index}_title_str",
                params["work_has_titles_attributes_#{index}_title_str"],
                :placeholder => t('activerecord.models.title'),
                :class => 'resource_title' %>
            <% end %>
            <%= w_f.select :title_type_id, @title_types.collect{|m| [m.display_name,m.id]} %>
            <%= w_f.hidden_field :title_id -%>
            <%= w_f.hidden_field :position -%>
            <%= button_to_function '+', 'ItemField_title.add()' %>
            <%= button_to_function '-', 'ItemField_title.remove(' + index.to_s + ')' if index > 0 %>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :identifier %><br />
    <%= f.text_field :identifier %>
    <%#= select :numbering, :type, @numberings.map{|n| [n.display_name, n.name]} %>
    <%= select2_script "numbering_type" %>
    <%= make_select2_struct("numbering_type", "numbering[type]", numberings, nil, 250, false) %>
    <%= link_to t('activerecord.models.numbering'), {}, :onClick => "numbering();false", :remote => true %>
  </div>

  <%= render 'form_agent_field' %>
  <div class="field">
    <%= f.label t('page.file') -%><br />
    <%= f.file_field :attachment -%>
    <% unless @manifestation.new_record? %>
      <%- unless @manifestation.attachment_file_name.blank? -%>
        <%= f.check_box :delete_attachment, :onClick => "toggle_upload()" -%><%= t('manifestation.delete_attachment') -%>
        <%= render 'manifestations/attachment_file', :manifestation => @manifestation -%>
      <%- end -%>
    <% end %>
  </div>

  <script type="text/javascript">
    function toggle_upload(){
      if ($('#manifestation_delete_attachment').attr('checked')){
        $('#manifestation_attachment').attr("disabled", true);
      } else {
        $('#manifestation_attachment').removeAttr("disabled");
      }
    }
  </script>

  <div class="field">
    <%= f.label t('activerecord.models.carrier_type') -%>
    <%#= f.select(:carrier_type_id, @carrier_types.collect{|m| [m.display_name.localize, m.id]}) -%>
    <%= select2_script "carrier_type_id" %>
    <%= make_select2(:carrier_type_id, "manifestation[carrier_type_id]", @carrier_types, @manifestation.carrier_type_id, 250, false) %>
    <!-- TODO: Formの切り替え時に入力項目をAjaxで書き換える -->
    <br>
  </div>
  <div class="field">
    <%= f.label t('activerecord.models.manifestation_type') -%>
    <%#= f.select(:manifestation_type_id, @manifestation_types.collect{|m| [m.display_name.localize, m.id]}) -%>
    <%= select2_script "manifestation_type_id" %>
    <%= make_select2(:manifestation_type_id, "manifestation[manifestation_type_id]", @manifestation_types, @manifestation.manifestation_type_id, 300, false) %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.jpn_or_foreign') %>
    <%#= f.select :jpn_or_foreign, Manifestation::JPN_OR_FOREIGN, :include_blank => true %>
    <%= select2_script "jpn_or_foreign" %>
    <%= make_select2_struct(:jpn_or_foreign, "manifestation[jpn_or_foreign]", Manifestation::JPN_OR_FOREIGN, @manifestation.jpn_or_foreign, 200, true, false) %>
  </div>

  <div class="field" id="frequency_field">
    <%= f.label t('activerecord.models.frequency') -%>
    <%= f.select(:frequency_id, @frequencies.collect{|frequency| [frequency.display_name.localize, frequency.id]}) -%>
  </div>

  <div class="field">
    <%= f.label :pub_date, :class => 'pub_date' -%>
    <%= f.text_field :pub_date, :class => 'date_field', :placeholder => "#{t('page.example')}: 2011, 2011-04-12"-%>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.country_of_publication') -%>
    <%#= f.select(:country_of_publication_id, @countries.collect{|country| [country.display_name.localize, country.id]}) -%>
    <%= select2_script "country_of_publication_id" %>
    <%= make_select2(:country_of_publication_id, "manifestation[country_of_publication_id]", @countries, @manifestation.country_of_publication_id, 400, false, false) %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.place_of_publication') -%>
    <%= f.text_field :place_of_publication %>
  </div>

  <div class="field" id="language">
    <%= f.label t('activerecord.models.language') -%>
    <% if @work_has_languages.blank? %>
      <div id="LANG0">
        <%#= select_tag 'language_id[0]',
            options_for_select(@languages.collect{ |l| [l.display_name.localize, l.id] },
            :selected => @default_language.id ) %>
        <%#= select_tag 'language_type[0]',
            options_for_select(@language_types.collect{ |t| [t.display_name.localize, t.id] }) %>

        <%= select2_script "language_id_0" %>
        <%= make_select2("manifestation", 'language_id[0]', @languages, @default_language.id, 300) %>
        <%= select2_script "language_type_0" %>
        <%= make_select2("manifestation", 'language_type[0]', @languages, 0, 200) %>
        <%= button_to_function '+', 'ItemField_language_select2.add()' -%>
      </div>
    <% else %>
      <% @work_has_languages.each_with_index do |whl, i| %>
        <div id="LANG<%= i.to_s %>">
          <%#= select_tag 'language_id[' + i.to_s + ']',
              options_for_select(@languages.collect{|l| [l.display_name.localize, l.id] },
              :selected => whl[:language_id] ) %>
          <%#= select_tag 'language_type[' + i.to_s + ']',
              options_for_select(@language_types.collect{ |t| [t.display_name.localize, t.id] },
              :selected => whl[:language_type_id] ) %>

          <%= select2_script "language_id_" + i.to_s %>
          <%= make_select2("language_id_" + i.to_s, "language_id[" + i.to_s + "]", @languages, whl.language_id, 300) %>
          <%= select2_script "language_type_" + i.to_s %>
          <%= make_select2("language_type_" + i.to_s, "language_type[" + i.to_s + "]", @language_types, whl.language_type_id, 200) %>
          <%= button_to_function '+', 'ItemField_language_select2.add()' -%>
          <%= button_to_function '-', 'ItemField_language_select2.remove(' + i.to_s + ')' if i > 0 -%>
        </div>
      <% end %>
    <% end %>
  </div>

  <%- if @manifestation.series_statement -%>
    <%= render :partial => 'manifestations/serial_form', :locals => {:f => f, :manifestation => @manifestation} -%>
  <%- else -%>
    <div class="field">
      <%= f.label :edition_display_value -%>
      <%= f.text_field :edition_display_value, :size=>"10" -%>
      <%= f.label :volume_number_string -%>
      <%= f.text_field :volume_number_string, :size=>"10" -%>
      <%= f.label :issue_number_string -%>
      <%= f.text_field :issue_number_string, :size=>"10" -%>
    </div>

    <div class="field">
      <%= f.label :isbn -%>
      <%= f.text_field :isbn, :class => 'resource_isbn_issn', :style => 'ime-mode: disabled' -%>
      <%= link_to_function t('activerecord.attributes.manifestation.wrong_isbn'), "$('#manifestation_wrong_isbn').toggle()" -%>
      <%= f.text_field :wrong_isbn, :class => 'resource_isbn_issn', :style => 'ime-mode: disabled; display: none' -%>
    </div>
    <div class="field">
      <%= f.label :lccn -%>
      <%= f.text_field :lccn, :class => 'resource_isbn_issn', :style => 'ime-mode: disabled' -%>
    </div>
    <div class="field">
      <%= f.label :marc_number -%>
      <%= f.text_field :marc_number, :class => 'resource_isbn_issn', :style => 'ime-mode: disabled' -%>
    </div>
    <div class="field">
      <%= f.label :ndc -%>
      <%= f.text_field :ndc, :class => 'resource_isbn_issn', :style => 'ime-mode: disabled' -%>
    </div>
  <%- end -%>

  <% if SystemConfiguration.get('manifestation.use_identifiers') %>
    <div id="identifiers">
      <%= f.label t('activerecord.models.identifier') -%><br />
      <% @manifestation.identifiers.each_with_index do |identifier, index| %>
        <%= f.fields_for :identifiers, identifier do |i_f| %>
          <div class="field" id="identifiers_<%= index %>">
            <%= i_f.text_field :body %>
            <%= i_f.select :identifier_type_id, @identifier_types.collect{|type| [type.display_name, type.id]} %>
            <%= i_f.hidden_field :position, :value => index %> 
            <%= button_to_function '+', 'ItemField_identifier.add()' -%>
            <%= button_to_function '-', "ItemField_identifier.remove(#{index})" if index > 0 -%><br />
           </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :start_page -%>
    <%= f.text_field :start_page, :class => 'resource_integer' -%>
    <%= f.label :end_page -%>
    <%= f.text_field :end_page, :class => 'resource_integer' -%>
  </div>

  <div class="field">
    <%= f.label :height -%>(cm)
    <%= f.text_field :height, :class => 'resource_integer' -%>
    <%= f.label :width -%>(cm)
    <%= f.text_field :width, :class => 'resource_integer' -%>
    <%= f.label :depth -%>(cm)
    <%= f.text_field :depth, :class => 'resource_integer' -%>
  </div>

  <div class="field">
    <%= f.label :price -%>
    <%= f.text_field :price, :class => 'resource_integer' -%>
  </div>

  <div class="field">
    <%= f.label :access_address -%><br />
    <%= f.url_field :access_address, :class => 'resource_url' -%>
  </div>

  <div class="field">
    <%= f.label :repository_content -%>
    <%= f.check_box :repository_content -%>
  </div>

  <div class="field">
    <%= f.label t('role.required_role') -%>
    <%#= f.select(:required_role_id, @roles.collect{|r| [r.display_name.localize, r.id]}) -%>
    <%= select2_script "required_role_id"%>
    <%= make_select2(:required_role_id, "manifestation[required_role_id]", @roles, @manifestation.required_role_id, 150, false, false) %>
  </div>

  <div class="field">
    <%= f.label :except_recent -%>
    <%= f.check_box :except_recent -%>
  </div>

  <div class="field">
    <%= f.label :description -%><br />
    <%= f.text_area :description, :class => 'resource_textarea' -%>
  </div>

  <div class="field">
    <%= f.label :supplement -%><br />
    <%= f.text_area :supplement, :class => 'resource_textarea' -%>
  </div>

  <div class="field">
    <%= f.label :note -%><br />
    <%= f.text_area :note, :class => 'resource_textarea' -%>
  </div>

  <div class="field">
    <%= f.label :subject -%><%= t('manifestation.delim_semicolon') -%><br />
    <%= f.text_field :subject, :value => @subject -%>
  </div>
  <div class="field">
    <strong><%= t('manifestation.subject_transcription') -%></strong><%= t('manifestation.delim_semicolon') -%><br />
    <%= f.text_field :subject_transcription, :value => @subject_transcription, :class => 'resource_url' -%>
  </div>

  <% if defined?(EnjuTrunkTheme) %>
    <div class="field">
      <strong><%= t('activerecord.models.theme') %></strong><br />
      <%= f.text_field :theme, :id => 'manifestation_theme', :value => @keep_themes %>
    </div>
  <% end %>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.missing_issue') -%>
    <%#= f.select :missing_issue, missing_issue_statuses, :include_blank => true -%>
    <%= select2_script "missing_issue" %>
    <%= make_select2_struct(:missing_issue, "manifestation[missing_issue]", missing_issue_statuses, @manifestation.missing_issue, 200, true, false) %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.acceptance_number') %>
    <%= f.text_field :acceptance_number, :class => "resource_integer" %>
  </div>

<% if false %> 
  <%#= TODO for exinfo: change property_name(=> exinfo1) when use this form. %>
  <div class="field">
    <label>exinfo</label><br /> 
    <%= text_field :exinfos, :exinfo1, :value => @exinfo1, :class => "" %>
  </div>
  <%#= TODO for extext: change property_name(=> extext1) when use this form. %>
  <div class="field">
    <label>extext</label><br /> 
    <%= text_field :extexts, :extext1, :value => @extext1, :class => "" %>
  </div>
<% end %>
<!--
  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_2') %>
    <%= f.text_field :exinfo_2, :class => "resource_integer" %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_3') %>
    <%= f.text_field :exinfo_3, :class => "resource_integer" %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_4') %>
    <%= f.text_field :exinfo_4, :class => "resource_integer" %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_5') %>
    <%= f.text_field :exinfo_5, :class => "resource_integer" %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_6') %>
    <%= f.text_field :exinfo_6, :class => "resource_integer" %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_7') %>
    <%= f.text_field :exinfo_7, :class => "resource_integer" %>
  </div>

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.exinfo_8') %>
    <%= f.text_field :exinfo_8, :class => "resource_integer" %>
  </div>
-->

  <div class="field">
    <%= f.label t('activerecord.attributes.manifestation.use_license_id') %><br />
    <%#= f.select :use_license_id, @use_licenses.collect{|l| [l.agency_name, l.id]} , :include_blank => true %>
    <%# TODO make_select2 内の分岐がうまくできない %>
    <%= select2_script "use_license_id" %>
    <%= make_select2_struct(
      :use_license_id, 
      "manifestation[use_license_id]", 
      use_licenses, 
      @manifestation.use_license_id, 
      250, 
      true, 
      false
    ) %>
  </div>

  <div class="actions">
    <%= hidden_field_tag :agent_id, @agent.id if @agent -%>
    <%= hidden_field_tag :manifestation_id, @original_manifestation.id if @original_manifestation -%>
    <%= hidden_field_tag :creators, @creators if @creators -%>
    <%= hidden_field_tag :contributors, @contributors if @contributors -%>
    <%= hidden_field_tag :publishers, @publishers if @publishers -%>
    <%= hidden_field_tag :subjects, @subjects if @subjects -%>
    <%= f.submit :disable_with => t('page.wait') %>
  </div>
  <%= javascript_tag("$('#manifestation_original_title').focus()") -%>
<%- end -%>
