<%= form_tag({:controller => 'manifestations'}, {:method => 'get'}) do -%>
<table id="advanced_search">
  <tr>
    <td><label><%= advanced_search_label(:query) -%>:</label></td>
    <td><%= search_field_tag 'query', params[:query], :class => 'search_form_short', :placeholder => t('page.search_term') -%><br />
        <%= advanced_search_merge_tag('query') -%><br />
        <%= search_field_tag 'except_query', params[:except_query] -%><%= advanced_search_label(:except_query) %><br />
        <%= t('advanced_search.help_query') -%>
    </td>
  </tr>
  <% if defined?(EnjuBookmark) %>
    <tr class="local-only">
      <td><label><%= advanced_search_label(:tag) -%>:</label></td>
      <td><%= search_field_tag 'tag', params[:tag] -%></td>
    </tr>
  <%- end -%>
  <tr class="local-only">
    <td><label><%= advanced_search_label(:manifestation_types) -%>:</label></td>
    <td><div class='parent'>
      <% if @selected_manifestation_types %>
        <%= check_box_tag 'all_manifestation_types', true, @selected_manifestation_types.size == @manifestation_types.size ? true : false, :class => 'check-parent' %><%= t('advanced_search.all', :model => t('activerecord.models.manifestation_type')) %><br />
      <% end %>
      <% @manifestation_types.each_with_index do |manifestation_type, i| %>
        <% if params[:manifestation_types] %>
          <% manifestation_types = params[:manifestation_types] %>
          <%= check_box 'manifestation_types', manifestation_type.id, {:checked => manifestation_types.has_key?(manifestation_type.id.to_s), :class => 'check-child'}, true, false %>
          <%= manifestation_type.display_name.localize -%>
          <%- if [5,9].include?(i) %><br /><%- end -%>
        <% end %>
      <% end %>
    </div></td>
  </tr>
  <tr>
    <td><label><%= advanced_search_label(:title) -%>:</label></td>
    <td><%= search_field_tag 'title', params[:title] -%><br />
        <%= advanced_search_merge_tag('title') %><br />
        <%= search_field_tag 'except_title', params[:except_title] -%><%= advanced_search_label(:except_title) %>
    </td>
  </tr>
  <tr>
    <td><label><%= advanced_search_label(:creator) -%>:</label></td>
    <td><%= search_field_tag 'creator', params[:creator] -%>
      <%= advanced_search_merge_tag('creator') %>
      <br />
      <%= search_field_tag 'except_creator', params[:except_creator] -%><%= advanced_search_label(:except_creator) %>
    </td>
  </tr>
  <tr>
    <td><label><%= advanced_search_label(:publisher) -%>:</label></td>
    <td><%= search_field_tag 'publisher', params[:publisher] -%></td>
  </tr>
  <tr>
    <td><label><%= advanced_search_label(:isbn) -%>:</label></td>
    <td><%= search_field_tag 'isbn', params[:isbn] -%><%= t('advanced_search.help_isbn') -%></td>
  </tr>
  <tr>
    <td><label><%= advanced_search_label(:issn) -%>:</label></td>
    <td><%= search_field_tag 'issn', params[:issn] -%><%= t('advanced_search.help_issn') -%></td>
  </tr>
  <%- if SystemConfiguration.get('manifestation.use_identifiers') %>
    <tr>
      <td><nobr><label><%= advanced_search_label(:other_identifier) -%>:</label></nobr></td>
      <td>
        <%#= select2_tag 'other_identifier_identifier_type',
          'other_identifier[identifier_type_id]',
          IdentifierType.all,
          (params[:other_identifier][:identifier_type_id].to_i rescue nil),
          select_attribute: :id,
          display_attribute: :display_name,
          include_blank: true,
          width: '200' %>
        <%= search_field_tag 'other_identifier[identifier]', (params[:other_identifier][:identifier] rescue nil) %>
      </td>
    </tr>
  <%- end -%>
  <tr>
  <%# = render :partial => 'form_classification_field' -%>
  </tr>
  <tr>
    <td><label><%= t('page.number') -%>:</label></td>
    <td>
      <%= advanced_search_label(:edition_display_value) -%>
      <%= search_field_tag 'edition_display_value', params[:edition_display_value], :class => 'num_text_field' -%>
      <%= advanced_search_label(:volume_number_string) -%>
      <%= search_field_tag 'volume_number_string', params[:volume_number_string], :class => 'num_text_field'-%>
      <%= advanced_search_label(:issue_number_string) -%>
      <%= search_field_tag 'issue_number_string', params[:issue_number_string], :class => 'num_text_field' -%>
      <%= advanced_search_label(:serial_number_string) -%>
      <%= search_field_tag 'serial_number_string', params[:serial_number_string], :class => 'num_text_field' -%>
    </td>
  </tr>
  <tr>
    <td><label><%= advanced_search_label(:subject_text) -%>:</label></td>
    <td>
      <%= search_field_tag 'subject_text', params[:subject_text] -%>
      <%= advanced_search_merge_tag('subject_text') %>
    </td>
  </tr>
  <% if current_user.try(:has_role?, 'Librarian') || SystemConfiguration.get("attributes.search.user.item.item_identifier") %>
    <tr class="local-only">
      <td><label><%= advanced_search_label(:item_identifier) -%>:</label></td>
      <td><%= search_field_tag 'item_identifier', params[:item_identifier] -%></td>
    </tr>
  <% end %>
  <% if current_user.try(:has_role?, 'Librarian') || SystemConfiguration.get("attributes.search.user.manifestation.identifier") %>
    <tr class="local-only">
      <td><label><%= advanced_search_label(:identifier) -%>:</label></td>
      <td><%= search_field_tag 'identifier', params[:identifier] -%></td>
    </tr>
  <% end %>
  <tr class="local-only">
    <td><label><%= advanced_search_label(:pub_date) -%>:</label></td>
    <td><%= t('advanced_search.from') -%> <%= search_field_tag 'pub_date_from', params[:pub_date_from], :class => 'date_text_field', :placeholder => "#{t('page.example')}: 1978, 1978-04-12" -%>
      <%= t('advanced_search.to') -%> <%= search_field_tag 'pub_date_to', params[:pub_date_to], :class => 'date_text_field', :placeholder => "#{t('page.example')}: 2011, 2011-04-12"-%></td>
  </tr>
  <tr class="local-only">
    <td><label><%= advanced_search_label(:acquired) -%>:</label></td>
    <td><%= t('advanced_search.from') -%> <%= search_field_tag 'acquired_from', params[:acquired_from], :class => 'date_text_field', :placeholder => "#{t('page.example')}: 2005, 2005-04-01" -%>
      <%= t('advanced_search.to') -%> <%= search_field_tag 'acquired_to', params[:acquired_to], :class => 'date_text_field', :placeholder => "#{t('page.example')}: 2011, 2011-03-31"-%></td>
  </tr>
  <% if current_user.try(:has_role?, 'Librarian') || SystemConfiguration.get("attributes.search.user.item.removed_at") %>
  <%# if user_signed_in? and current_user.has_role?('Librarian') %>
    <tr class="local-only">
      <td><label><%= advanced_search_label(:removed) %>:</label></td>
      <td>
        <%= t('advanced_search.from') %>
        <%= search_field_tag 'removed_from', params[:removed_from], :class => 'date_text_field', :placeholder => "#{t('page.example')}: 2005, 2005-04-01" %>
        <%= t('advanced_search.to') %>
        <%= search_field_tag 'removed_to', params[:removed_to], :class => 'date_text_field', :placeholder => "#{t('page.example')}: 2011, 2011-03-31" %>
      </td>
    </tr>
  <% end %>
  <% if false %>
    <tr>
      <td><label><%= advanced_search_label(:number_of_pages) -%>:</label></td>
        <td><%= t('advanced_search.from') -%> <%= search_field_tag 'number_of_pages_at_least', params[:number_of_pages_at_least], :size => 5 -%>
          <%= t('advanced_search.to') -%> <%= search_field_tag 'number_of_pages_at_most', params[:number_of_pages_at_most], :size => 5 -%></td>
    </tr>
  <% end %>
  <tr>
    <td></td>
    <td>
      <%= hidden_field_tag 'advanced_search', 'true' -%>
      <%= hidden_field_tag 'user_id', params[:user_id] if params[:user_id] -%>
      <%= hidden_field_tag 'series_statement_id', params[:series_statement_id] if params[:series_statement_id] %>
      <%= submit_tag t('page.search') -%>
      <%= button_to_function t('advanced_search.clear_query'), "clear_all()" %>
    </td>
  </tr>
</table>
<%- end -%>
